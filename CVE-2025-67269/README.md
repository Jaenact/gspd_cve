# CVE-2025-67269: Integer Underflow Leading to Denial of Service in NAVCOM Packet Parsing

## Description

An integer underflow vulnerability was discovered in the NAVCOM driver state machine of gpsd. The vulnerability exists in the `nextstate()` function in `packet.c`, specifically when handling the `NAVCOM_ID` state.

When parsing a NAVCOM packet, the code calculates the payload length by subtracting the header size (4 bytes) from the packet ID byte (`c`). However, it fails to verify if `c` is actually greater than or equal to 4. If `c` is less than 4 (e.g., 0, 1, 2, 3), the subtraction `(size_t)c - 4` underflows, resulting in a huge `size_t` value (near `SIZE_MAX`).

## Affected Versions

- gpsd versions prior to 3.27.1.

## Impact

- **Denial of Service (DoS)**: The resulting large length value causes the packet state machine to attempt to read an extreme amount of data. This leads to 100% CPU utilization as the lexer continues to process the input, effectively hanging the daemon and preventing it from responding to other clients until the process is restarted.

## Attack Vector

- **Remote/Network**: If gpsd is listening on a network port, a remote attacker can send the malicious packet.
- **Local/Serial**: An attacker with access to a serial device fed into gpsd can trigger this.

## Root Cause

Missing boundary check for the ID byte used to calculate length.

```c
// Vulnerable code snippet in gpsd/packet.c
case NAVCOM_ID:
    /*
     * The ID byte 'c' is used to determine length.
     * Code assumes c >= 4 to subtract header length.
     */
    lexer->length = (size_t)c - 4; // <--- Underflows if c < 4
    lexer->state = NAVCOM_LENGTH_1;
    break;
```

## Proof of Concept

**Note**: Full exploit code is withheld for responsible disclosure.

Concept-level description:

1.  **Transport**: Any supported input channel (Network or Serial).
2.  **Packet Structure**:
    - `0x02` (STX)
    - `0x99` (TM)
    - `0x66` (ID check)
    - `0x00` (Agrees with 0x66 check, but value is 0)
3.  **Mechanism**: The parser matches the header bytes and reaches `NAVCOM_ID` state. It reads `0x00`, calculates `0 - 4`, resulting in a massive unsigned integer.
4.  **Result**: Infinite loop / CPU exhaustion.

## Fix

Fixed in version 3.27.1.

## Timeline

- Discovered: 2025
- Reported to vendor: 2025
- Fixed: 3.27.1 Released

- CVE assigned: December 17, 2025
- Public disclosure: January 2, 2026

## Credits

- Discovered by: Jaehyun Lee
